<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF „Åæ„Å®„ÇÅ„Çã„ÇÑ„Å§</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;600;800&family=JetBrains+Mono:wght@400;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #0e0f13;
    --surface: #16171d;
    --surface2: #1e2028;
    --border: #2a2c36;
    --text: #e4e4e8;
    --text2: #8b8d9a;
    --accent: #f0673a;
    --accent2: #ff8c5a;
    --green: #4ade80;
    --red: #f87171;
    --radius: 10px;
  }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  header { margin-bottom: 36px; }

  header h1 {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -0.5px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  header p {
    color: var(--text2);
    font-size: 13px;
    margin-top: 6px;
    font-weight: 300;
  }

  .dropzone {
    border: 2px dashed var(--border);
    border-radius: var(--radius);
    padding: 48px 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.25s;
    background: var(--surface);
  }

  .dropzone:hover, .dropzone.dragover {
    border-color: var(--accent);
    background: rgba(240, 103, 58, 0.04);
  }

  .dropzone.dragover { transform: scale(1.01); }
  .dropzone-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.6; }

  .dropzone-text {
    font-size: 15px;
    font-weight: 400;
    color: var(--text2);
  }

  .dropzone-text strong {
    color: var(--accent);
    font-weight: 600;
  }

  .dropzone-sub {
    font-size: 11px;
    color: var(--text2);
    margin-top: 8px;
    opacity: 0.6;
  }

  .btn-add {
    width: 100%;
    margin-top: 10px;
    padding: 12px;
    border: 1px dashed var(--border);
    border-radius: 8px;
    background: var(--surface);
    color: var(--text2);
    font-size: 13px;
    font-family: 'Noto Sans JP', sans-serif;
    cursor: pointer;
    transition: all 0.15s;
    display: none;
  }

  .btn-add:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .file-list {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .file-item {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    transition: all 0.2s;
    user-select: none;
  }

  .file-item:hover {
    border-color: #3a3c48;
    background: var(--surface2);
  }

  .file-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    font-weight: 600;
    color: var(--accent);
    background: rgba(240, 103, 58, 0.12);
    width: 26px;
    height: 26px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .file-info {
    flex: 1;
    min-width: 0;
  }

  .file-name {
    font-size: 13px;
    font-weight: 400;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-meta {
    font-size: 11px;
    color: var(--text2);
    font-family: 'JetBrains Mono', monospace;
    margin-top: 2px;
  }

  .file-controls {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
  }

  .file-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--text2);
    cursor: pointer;
    font-size: 14px;
    width: 30px;
    height: 30px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    line-height: 1;
    -webkit-tap-highlight-color: transparent;
  }

  .file-btn:hover:not(:disabled) {
    color: var(--text);
    border-color: var(--text2);
    background: var(--surface2);
  }

  .file-btn:active:not(:disabled) {
    background: var(--border);
  }

  .file-btn:disabled {
    opacity: 0.2;
    cursor: not-allowed;
  }

  .file-btn.remove:hover {
    color: var(--red);
    border-color: var(--red);
    background: rgba(248, 113, 113, 0.08);
  }

  .actions {
    margin-top: 28px;
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .btn-merge {
    flex: 1;
    padding: 14px 24px;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    font-family: 'Noto Sans JP', sans-serif;
    cursor: pointer;
    transition: all 0.2s;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: #fff;
  }

  .btn-merge:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 6px 24px rgba(240, 103, 58, 0.3);
  }

  .btn-merge:disabled {
    opacity: 0.35;
    cursor: not-allowed;
    transform: none;
  }

  .btn-clear {
    padding: 14px 20px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 13px;
    font-weight: 400;
    font-family: 'Noto Sans JP', sans-serif;
    cursor: pointer;
    transition: all 0.15s;
    background: var(--surface);
    color: var(--text2);
  }

  .btn-clear:hover {
    border-color: var(--red);
    color: var(--red);
  }

  .status {
    margin-top: 16px;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 13px;
    display: none;
    align-items: center;
    gap: 8px;
  }

  .status.show { display: flex; }

  .status.processing {
    background: rgba(240, 103, 58, 0.08);
    border: 1px solid rgba(240, 103, 58, 0.2);
    color: var(--accent2);
  }

  .status.success {
    background: rgba(74, 222, 128, 0.08);
    border: 1px solid rgba(74, 222, 128, 0.2);
    color: var(--green);
  }

  .status.error {
    background: rgba(248, 113, 113, 0.08);
    border: 1px solid rgba(248, 113, 113, 0.2);
    color: var(--red);
  }

  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid transparent;
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    flex-shrink: 0;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .progress-bar {
    width: 100%;
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 8px;
    overflow: hidden;
    display: none;
  }

  .progress-bar.show { display: block; }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 2px;
    transition: width 0.3s;
    width: 0%;
  }

  .filename-row {
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .filename-row label {
    font-size: 12px;
    color: var(--text2);
    flex-shrink: 0;
  }

  .filename-input {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 13px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text);
    outline: none;
    transition: border-color 0.15s;
  }

  .filename-input:focus { border-color: var(--accent); }

  .filename-ext {
    font-size: 13px;
    color: var(--text2);
    font-family: 'JetBrains Mono', monospace;
  }

  @media (max-width: 500px) {
    .container { padding: 24px 16px 60px; }
    header h1 { font-size: 22px; }
    .dropzone { padding: 36px 16px; }
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>PDF „Åæ„Å®„ÇÅ„Çã„ÇÑ„Å§</h1>
    <p>PDF„ÇíËøΩÂä† ‚Üí ‰∏¶„Å≥Êõø„Åà ‚Üí ÁµêÂêà„ÄÇÂÖ®ÈÉ®„Éñ„É©„Ç¶„Ç∂ÂÜÖ„ÅßÂÆåÁµê„ÄÇ</p>
  </header>

  <div class="dropzone" id="dropzone">
    <div class="dropzone-icon">üìÑ</div>
    <div class="dropzone-text">
      PDF„Çí„Åì„Åì„Å´„Éâ„É≠„ÉÉ„Éó or <strong>„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû</strong>
    </div>
    <div class="dropzone-sub">Ë§áÊï∞„Éï„Ç°„Ç§„É´ÈÅ∏ÊäûOK</div>
  </div>

  <button class="btn-add" id="btnAdd">Ôºã PDF„ÇíËøΩÂä†</button>

  <div class="file-list" id="fileList"></div>

  <div class="filename-row" id="filenameRow" style="display:none">
    <label>„Éï„Ç°„Ç§„É´Âêç:</label>
    <input type="text" class="filename-input" id="filenameInput" value="merged" placeholder="merged">
    <span class="filename-ext">.pdf</span>
  </div>

  <div class="actions" id="actions" style="display:none">
    <button class="btn-merge" id="btnMerge">ÁµêÂêà„Åô„Çã</button>
    <button class="btn-clear" id="btnClear">ÂÖ®Ê∂à„Åó</button>
  </div>

  <div class="status" id="status">
    <div class="spinner" id="statusSpinner"></div>
    <span id="statusText"></span>
  </div>

  <div class="progress-bar" id="progressBar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
</div>

<script>
const { PDFDocument } = PDFLib;

let files = [];

const dropzone = document.getElementById('dropzone');
const fileList = document.getElementById('fileList');
const filenameRow = document.getElementById('filenameRow');
const actions = document.getElementById('actions');
const btnMerge = document.getElementById('btnMerge');
const btnClear = document.getElementById('btnClear');
const btnAdd = document.getElementById('btnAdd');
const status = document.getElementById('status');
const statusSpinner = document.getElementById('statusSpinner');
const statusText = document.getElementById('statusText');
const progressBar = document.getElementById('progressBar');
const progressFill = document.getElementById('progressFill');
const filenameInput = document.getElementById('filenameInput');

function openFilePicker() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.pdf,application/pdf';
  input.multiple = true;
  input.style.display = 'none';
  document.body.appendChild(input);
  input.addEventListener('change', () => {
    if (input.files && input.files.length > 0) {
      addFiles(input.files);
    }
    document.body.removeChild(input);
  });
  input.click();
}

dropzone.addEventListener('click', openFilePicker);
dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('dragover'); });
dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
dropzone.addEventListener('drop', e => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
  addFiles(e.dataTransfer.files);
});

btnAdd.addEventListener('click', openFilePicker);

function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(1) + ' MB';
}

function escHtml(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

async function addFiles(fileListInput) {
  const arr = Array.from(fileListInput);
  for (const f of arr) {
    if (f.type === 'application/pdf' || f.name.toLowerCase().endsWith('.pdf')) {
      let pages = '?';
      try {
        const buf = await f.arrayBuffer();
        const doc = await PDFDocument.load(buf, { ignoreEncryption: true });
        pages = doc.getPageCount();
      } catch(e) {}
      files.push({ file: f, name: f.name, size: f.size, pages });
    }
  }
  render();
}

function moveFile(fromIdx, toIdx) {
  if (toIdx < 0 || toIdx >= files.length) return;
  const [moved] = files.splice(fromIdx, 1);
  files.splice(toIdx, 0, moved);
  render();
}

function removeFile(idx) {
  files.splice(idx, 1);
  hideStatus();
  render();
}

function render() {
  fileList.innerHTML = '';
  const hasFiles = files.length > 0;

  actions.style.display = hasFiles ? 'flex' : 'none';
  filenameRow.style.display = hasFiles ? 'flex' : 'none';
  btnAdd.style.display = hasFiles ? 'block' : 'none';
  btnMerge.disabled = files.length < 2;

  files.forEach((f, i) => {
    const el = document.createElement('div');
    el.className = 'file-item';
    el.innerHTML = `
      <span class="file-num">${i + 1}</span>
      <div class="file-info">
        <div class="file-name">${escHtml(f.name)}</div>
        <div class="file-meta">${formatSize(f.size)} ¬∑ ${f.pages}„Éö„Éº„Ç∏</div>
      </div>
      <div class="file-controls">
        <button class="file-btn up" title="‰∏ä„Å∏" ${i === 0 ? 'disabled' : ''}>‚ñ≤</button>
        <button class="file-btn down" title="‰∏ã„Å∏" ${i === files.length - 1 ? 'disabled' : ''}>‚ñº</button>
        <button class="file-btn remove" title="ÂâäÈô§">√ó</button>
      </div>
    `;

    el.querySelector('.up').addEventListener('click', () => moveFile(i, i - 1));
    el.querySelector('.down').addEventListener('click', () => moveFile(i, i + 1));
    el.querySelector('.remove').addEventListener('click', () => removeFile(i));

    fileList.appendChild(el);
  });
}

function showStatus(type, text) {
  status.className = `status show ${type}`;
  statusSpinner.style.display = type === 'processing' ? 'block' : 'none';
  statusText.textContent = text;
}

function hideStatus() {
  status.className = 'status';
  progressBar.className = 'progress-bar';
}

btnClear.addEventListener('click', () => {
  files = [];
  hideStatus();
  render();
});

btnMerge.addEventListener('click', async () => {
  if (files.length < 2) return;

  btnMerge.disabled = true;
  showStatus('processing', 'ÁµêÂêà‰∏≠...');
  progressBar.className = 'progress-bar show';
  progressFill.style.width = '0%';

  try {
    const merged = await PDFDocument.create();
    let totalPages = 0;

    for (let i = 0; i < files.length; i++) {
      const buf = await files[i].file.arrayBuffer();
      const doc = await PDFDocument.load(buf, { ignoreEncryption: true });
      const pages = await merged.copyPages(doc, doc.getPageIndices());
      pages.forEach(p => merged.addPage(p));
      totalPages += pages.length;
      progressFill.style.width = `${((i + 1) / files.length) * 90}%`;
    }

    const pdfBytes = await merged.save();
    progressFill.style.width = '100%';

    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const fname = (filenameInput.value.trim() || 'merged') + '.pdf';
    a.href = url;
    a.download = fname;
    a.click();
    setTimeout(() => URL.revokeObjectURL(url), 3000);

    showStatus('success', `ÂÆå‰∫ÜÔºÅ ${files.length}„Éï„Ç°„Ç§„É´ ‚Üí ${totalPages}„Éö„Éº„Ç∏„ÅÆ${fname}„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ`);
  } catch (e) {
    console.error(e);
    showStatus('error', `„Ç®„É©„Éº: ${e.message}`);
  }

  btnMerge.disabled = false;
});
</script>
</body>
</html>
